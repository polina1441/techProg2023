#!/usr/bin/python
# -*- coding: utf8 -*-
import os, sys

import nltk
from nltk import word_tokenize
from nltk.probability import FreqDist
from nltk.corpus import stopwords
import matplotlib.pyplot as plt
import string

#Сгущенное молоко - Варлам Шаламов

def print_hi():
    # -*- coding: utf-8 -*-
    text = """От голода наша зависть была тупа и бессильна, как каждое из наших чувств. У нас не было силы на чувства, на то, чтобы искать работу полегче, чтобы ходить, спрашивать, просить... Мы завидовали только знакомым, тем, вместе с которыми мы явились в этот мир, тем, кому удалось попасть на работу в контору, в больницу, в конюшню – там не было многочасового тяжелого физического труда, прославленного на фронтонах всех ворот как дело доблести и геройства. Словом, мы завидовали только Шестакову.
    Только что-либо внешнее могло вывести нас из безразличия, отвести от медленно приближающейся смерти. Внешняя, а не внутренняя сила. Внутри все было выжжено, опустошено, нам было все равно, и дальше завтрашнего дня мы не строили планов.
    Вот и сейчас – хотелось уйти в барак, лечь на нары, а я все стоял у дверей продуктового магазина. В этом магазине могли покупать только осужденные по бытовым статьям, а также причисленные к «друзьям народа» воры-рецидивисты. Нам там было нечего делать, но нельзя было отвести глаз от хлебных буханок шоколадного цвета; сладкий и тяжелый запах свежего хлеба щекотал ноздри – даже голова кружилась от этого запаха. И я стоял и не знал, когда я найду в себе силы уйти в барак, и смотрел на хлеб. И тут меня окликнул Шестаков.
    Шестакова я знал по Большой земле, по Бутырской тюрьме: сидел с ним в одной камере. Дружбы у нас там не было, было просто знакомство. На прииске Шестаков не работал в забое. Он был инженер-геолог, и его взяли на работу в геологоразведку, в контору, стало быть. Счастливец едва здоровался со своими московскими знакомыми. Мы не обижались – мало ли что ему могли на сей счет приказать. Своя рубашка и т. д.
    – Кури, – сказал Шестаков и протянул мне обрывок газеты, насыпал махорки, зажег спичку, настоящую спичку...
    Я закурил.
    – Мне надо с тобой поговорить, – сказал Шестаков.
    – Со мной?
    – Да.
    Мы отошли за бараки и сели на борт старого забоя. Ноги мои сразу отяжелели, а Шестаков весело болтал своими новенькими казенными ботинками, от которых слегка пахло рыбьим жиром. Брюки завернулись и открыли шахматные носки. Я обозревал шестаковские ноги с истинным восхищением и даже некоторой гордостью – хоть один человек из нашей камеры не носит портянок. Земля под нами тряслась от глухих взрывов – это готовили грунт для ночной смены. Маленькие камешки падали у наших ног, шелестя, серые и незаметные, как птицы.
    – Отойдем подальше, – сказал Шестаков.
    – Не убьет, не бойся. Носки будут целы.
    – Я не о носках, – сказал Шестаков и провел указательным пальцем по горизонту. – Как ты смотришь на все это?
    – Умрем, наверно, – сказал я. Меньше всего мне хотелось думать об этом.
    – Ну нет, умирать я не согласен.
    – Ну?
    – У меня есть карта, – вяло сказал Шестаков. – Я возьму рабочих, тебя возьму и пойду на Черные Ключи – это пятнадцать километров отсюда. У меня будет пропуск. И мы уйдем к морю. Согласен?
    Он выложил все это равнодушной скороговоркой.
    – А у моря? Поплывем?
    – Все равно. Важно начать. Так жить я не могу. «Лучше умереть стоя, чем жить на коленях», – торжественно произнес Шестаков. – Кто это сказал?
    В самом деле. Знакомая фраза. Но не было сил вспомнить, кто и когда говорил эти слова. Все книжное было забыто. Книжному не верили. Я засучил брюки, показал красные цинготные язвы.
    – Вот в лесу и вылечишь, – сказал Шестаков, – на ягодах, на витаминах. Я выведу, я знаю дорогу. У меня есть карта...
    Я закрыл глаза и думал. До моря отсюда три пути – и все по пятьсот километров, не меньше. Не только я, но и Шестаков не дойдет. Не берет же он меня как пищу с собой? Нет, конечно. Но зачем он лжет? Он знает это не хуже меня; и вдруг я испугался Шестакова – единственного из нас, кто устроился на работу по специальности. Кто его туда устроил и какой ценой? За все ведь надо платить. Чужой кровью, чужой жизнью...
    – Я согласен, – сказал я, открывая глаза. – Только мне надо подкормиться.
    – Вот и хорошо, хорошо. Обязательно подкормишься. Я принесу тебе... консервов. У нас ведь можно...
    Есть много консервов на свете – мясных, рыбных, фруктовых, овощных... Но прекрасней всех – молочные, сгущенное молоко. Конечно, их не надо пить с кипятком. Их надо есть ложкой, или мазать на хлеб, или глотать понемножку, из банки, медленно есть, глядя, как желтеет светлая жидкая масса, как налипают на банку сахарные звездочки...
    – Завтра, – сказал я, задыхаясь от счастья, – молочных...
    – Хорошо, хорошо. Молочных. – И Шестаков ушел.
    Я вернулся в барак, лег и закрыл глаза. Думать было нелегко. Это был какой-то физический процесс – материальность нашей психики впервые представала мне во всей наглядности, во всей ощутимости. Думать было больно. Но думать было надо. Он соберет нас в побег и сдаст – это совершенно ясно. Он заплатит за свою конторскую работу нашей кровью, моей кровью. Нас или убьют там же, на Черных Ключах, или приведут живыми и осудят – добавят еще лет пятнадцать. Ведь не может же он не знать, что выйти отсюда нельзя. Но молоко, сгущенное молоко...
    Я заснул, и в своем рваном голодном сне я видел эту шестаковскую банку сгущенного молока – чудовищную банку с облачно-синей наклейкой. Огромная, синяя, как ночное небо, банка была пробита в тысяче мест, и молоко просачивалось и текло широкой струей Млечного Пути. И легко доставал я руками до неба и ел густое, сладкое, звездное молоко.
    Не помню, что я делал в этот день и как работал. Я ждал, ждал, пока солнце склонится к западу, пока заржут лошади, которые лучше людей угадывают конец рабочего дня.
    Хрипло загудел гудок, и я пошел к бараку, где жил Шестаков. Он ждал меня на крыльце. Карманы его телогрейки оттопыривались.
    Мы сели за большой вымытый стол в бараке, и Шестаков вытащил из кармана две банки сгущенного молока.
    Углом топора я пробил банку. Густая белая струя потекла на крышку, на мою руку.
    – Надо было вторую дырку пробить. Для воздуха, – сказал Шестаков.
    – Ничего, – сказал я, облизывая грязные сладкие пальцы.
    – Дайте ложку, – сказал Шестаков, поворачиваясь к обступившим нас рабочим. Десять блестящих, отлизанных ложек потянулись над столом. Все стояли и смотрели, как я ем. В этом не было неделикатности или скрытого желания угоститься. Никто из них и не надеялся, что я поделюсь с ним этим молоком. Такое не было видано – интерес их к чужой пище был вполне бескорыстен. И я знал, что нельзя не глядеть на пищу, исчезающую во рту другого человека. Я сел поудобнее и ел молоко без хлеба, запивая изредка холодной водой. Я съел обе банки. Зрители отошли в сторону – спектакль был окончен. Шестаков смотрел на меня сочувственно.
    – Знаешь что, – сказал я, тщательно облизывая ложку, – я передумал. Идите без меня.
    Шестаков понял и вышел, не сказав мне ни слова.
    Это было, конечно, ничтожной местью, слабой, как все мои чувства. Но что я мог сделать еще? Предупредить других – я не знал их. А предупредить было надо – Шестаков успел уговорить пятерых. Они бежали через неделю, двоих убили недалеко от Черных Ключей, троих судили через месяц. Дело о самом Шестакове было выделено производством, его вскоре куда-то увезли, через полгода я встретил его на другом прииске. Дополнительного срока за побег он не получил – начальство играло с ним честно, а ведь могло быть и иначе.
    Он работал в геологоразведке, был брит и сыт, и шахматные носки его все еще были целы. Со мной он не здоровался, и зря: две банки сгущенного молока не такое уж большое дело, в конце концов..."""

    print(f"Всего символов {len(text)}")
    text = text.lower() #приводим к нижнему регистру
    spec = string.punctuation  # !" #$%&\'()*+,-. /:;<=>? @[\\]^_`{|}~

    text = "".join([ch for ch in text if ch not in spec])  #очищаем строку и добавляем символы, не являющиеся специальными
    text = text.replace('–', '')
    print(f"Без специальных {len(text)}")

    nltk.download('punkt') #скачиваем токенизатор

    text_tokens = word_tokenize(text) #составляем список слов
    print(f"Слов в тексте {len(text_tokens)}")

    toText = nltk.Text(text_tokens)

    fdist = FreqDist(toText)
    print("Популярные слова:")
    print(f"{fdist.most_common(20)}") #список 20-ти наиболее часто встречающихся слов в тексте

    fdist.plot(35, cumulative = False, title='Частотный анализ текста')
    plt.show()#Отображаем график частотных слов

    nltk.download('stopwords')
    russian_stopwords = stopwords.words("russian") #определяем стоп-слова, загразняющие анализ

    text_tokens_clear = ([token for token in text_tokens if token not in russian_stopwords]) #убираем стоп-слова
    toTextClear = nltk.Text(text_tokens_clear)
    fdist2 = FreqDist(toTextClear)
    fdist2.plot(25, cumulative=False, title='Частотный анализ текста без стоп-слов')
    plt.show() # Отображаем график частотных слов
    print("Популярные чистые слова:")
    print(f"{fdist2.most_common(20)}")

if __name__ == '__main__':
    print_hi()
